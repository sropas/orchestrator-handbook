# Multi-Role Retrospective — Upload & Query Incident
- **Date / Time:** 2025-10-19 21:40
- **Facilitator:** SA (osadmin)
- **Attendees:** PM | SA | Backend | Frontend | Database | DevOps | Security | QA | Support | Accounting

## 1. Before vs After
- PM: ก่อนหน้า incident ไม่รู้สาเหตุ ต้องไล่ทีมแบบ ad-hoc / หลังแก้มี incident log + runbook เทมเพลตพร้อม briefing
- SA: ก่อนหน้า `/upload` ค้าง, localhost เข้าไม่ได้ / หลังแก้ใช้ threadpool + 127.0.0.1 fallback พร้อม health check
- Backend: ก่อนหน้า event loop ถูก block, ข้อความไทยแตกคำ / หลังแก้ normalize text, UI เป็นการ์ดสรุปอ่านง่าย
- Frontend: ก่อนหน้า UI แสดง raw dict อ่านไม่ออก / หลังแก้มี summary card, preview, metadata ชัดเจน
- Database: ก่อนหน้าไม่เห็นว่าข้อมูล ingest สำเร็จไหม / หลังแก้ metadata ชัด ยืนยันใน `chunks`
- DevOps: ก่อนหน้า restart บ่อยตรวจไม่ได้ / หลังแก้ rebuild + health watchdog, document ขั้นตอน
- Security: ก่อนหน้าไม่ enforce mock-first, ไม่มี log / หลังแก้บันทึกเหตุและแนะนโยบาย external provider
- QA: ก่อนหน้า smoke test ผ่าน HTTP แต่ไม่ยืนยัน UX / หลังแก้เทสเหมือนผู้ใช้จริง เห็นการ์ด/คะแนนชัด
- Support/Training: ก่อนหน้าอธิบายผู้ใช้ยาก / หลังแก้ใช้ capture หน้าจอใหม่สอนทีมได้ทันที
- Accounting: ก่อนหน้าไม่รู้เวลาทีมเสีย / หลังแก้ incident log บันทึกเวลาตามได้

## 2. ความรู้และบทเรียน
- Async vs sync: ต้องใช้ `run_in_threadpool` หรือ background worker เมื่อเรียก provider ภายนอก
- ภาษาไทยจาก PDF: ต้อง normalize whitespace, รวมบรรทัดเพื่อให้อ่านได้จริง
- UI: แสดงผลต้องมี summary + metadata เพื่อทีม support/QA ใช้ตรวจสอบเร็ว ๆ
- Tests: QA ต้องเตรียม test data ใกล้เคียงของจริง, ครอบ parameter หลากหลาย, ทดสอบเหมือนผู้ใช้
- Security: ต้องประกาศ mock-first, สื่อสารสถานะปัจจุบัน ไม่ปล่อยให้เงียบ
- DevOps: จำเป็นต้องมี health check/watchdog และบันทึก Fallback (127.0.0.1)

## 3. Action Items
- PM/SA → บันทึก incident ลง decision log และจัด recurring sync ทุกบทบาท (daily 15 นาที)
- Backend → เพิ่ม unit test สำหรับ `normalize_extracted_text` และ snapshot UI ใน test plan
- Frontend → เตรียม iteration ถัดไป (loading indicator, highlight keyword)
- QA → อัปเดต `docs/orchestrator/test-plan.md` ด้วยกรณีทดสอบจริง/พารามิเตอร์
- Security → สรุป mock-first policy + PDPA checklist ครั้งนี้, เตรียมรายงาน status
- DevOps → เพิ่ม script health check อัตโนมัติและ watchdog แจ้งเตือน response time > 30s
- Support/Training → ทำคู่มือ “อ่านการ์ดผลลัพธ์ RAG” ให้ user ภายใน
- Accounting → ดึงเวลา incident บันทึกใน time log

## 4. Reminders
- นักออกแบบ (Frontend) ถูกหักคะแนน -1 รอบนี้
- ผู้แก้ปัญหา (SA + Backend + DevOps + QA + Frontend) ได้คะแนนบวก รอ PM ลงคะแนน
- นำความรู้/สคริปต์ทั้งหมด push ขึ้น Git เพื่อ reuse ในโครงการอื่น
- ทุกทีมต้อง update สถานะในไฟล์ `orchestrator-handbook/docs/orchestrator/status/*.md` หลังงานนี้
